<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    2020-04-13-高阶面试题知识集合笔记 | Mother Ship的笔记
  </title>
  <meta name="description" content>
  
  <meta name="keywords" content="
  Java,面经读后感
  ">
  
  <meta name="author" content="Mother Ship">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="https://www.mothership.top/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  

  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <li class="desktop-only"><a href="/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="https://a.ppy.sh/2545898_.png"> <i class="fa fa-caret-down"></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i class="fa fa-file-text"></i> Posts </a>
        <a href="/archives" class="header-toolbar-right"> 53 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i class="fa fa-tags"></i> Tags </a>
        <a href="/tags" class="header-toolbar-right"> 48 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories" class="header-toolbar-right"> 20 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">Mother Ship的笔记</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    Mother Ship

    <span class="post-date float-right" title="{{moment(1586764396000).format('MMM DD, YYYY, h:mm:ss A')}}">
      <i class="fa fa-pencil-square-o"></i>
      {{moment(1586764396000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>2020-04-13-高阶面试题知识集合笔记</h1>
    <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>嗯……写了快三年代码了，回望一下自己的博客，从当年命名规范都不清楚的小白，到现在。。熟悉了命名规范的小白（笑）</p>
<p>对自我的定义应该是：比较擅长在需求较明确的前提下，使用常用工具构建无需特别优化的Java Web后端程序的Java程序员，也对爬虫和Web后端性能优化比较感兴趣。</p>
<p>曾经对微服务、消息队列、缓存等知识是兴致缺缺，一方面没有好的资料，一方面两三年前不需要这些知识的岗位机会也有不少。</p>
<p>然而两年九个月过去了，对一些单机Web后端用到的技术，不敢说熟悉，日常理解是没多大问题了；恰好经树总推荐，拜读了DDIA，以及一些讲述大型网站的书籍，觉得是时候总结一些这方面的知识了。</p>
<p>虽然总觉得这些是90%的企业用不到的东西，但毕竟竞争日益激烈，再加上像是<strong><code>@Transaction</code> <code>@Cacheable</code>注解是基于AOP，AOP又是基于动态代理</strong>，或者是<strong>JVM采用分代垃圾收集，年轻代标记复制到老年代，老年代用CMS标记并发清除，或者用G1分区域标记整理</strong>这些几年前学过的知识点，反复啃起来也没什么意思。。</p>
<h3 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h3><h4 id="优缺点、如何选型"><a href="#优缺点、如何选型" class="headerlink" title="优缺点、如何选型"></a>优缺点、如何选型</h4><h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h5><ul>
<li><p>降低订阅消息与否的开发成本</p>
</li>
<li><p>异步化逻辑，提高性能</p>
</li>
</ul>
<h5 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h5><ul>
<li>降低可用性，一致性，提高复杂度</li>
</ul>
<h5 id="选型："><a href="#选型：" class="headerlink" title="选型："></a>选型：</h5><p><a href="http://www.ijiandao.com/2b/baijia/97775.html" target="_blank" rel="noopener">http://www.ijiandao.com/2b/baijia/97775.html</a></p>
<h6 id="延迟："><a href="#延迟：" class="headerlink" title="延迟："></a>延迟：</h6><p>RabbitMQ微秒级延迟，RocketMQ、Kafka使用长轮询，毫秒级</p>
<h6 id="吞吐："><a href="#吞吐：" class="headerlink" title="吞吐："></a>吞吐：</h6><p>RabbitMQ万级，RocketMQ、Kafka十万级</p>
<p>Kafka的TPS在64个Topic时可以保持13万，到了128个Topic就跌至0.85万，原因是每个Topic、每个分区都会对应一个物理文件</p>
<h6 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h6><p>RabbitMQ主从架构，RocketMQ、Kafka分布式架构</p>
<h6 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h6><p>RocketMQ支持定时消息、事务消息，消息查询，按时间回溯，乱序消费，消费轨迹，消息过滤</p>
<h4 id="幂等性"><a href="#幂等性" class="headerlink" title="幂等性"></a>幂等性</h4><h4 id="可靠性"><a href="#可靠性" class="headerlink" title="可靠性"></a>可靠性</h4><p><a href="http://jm.taobao.org/2016/04/28/kafka-vs-rocktemq-4/" target="_blank" rel="noopener">http://jm.taobao.org/2016/04/28/kafka-vs-rocktemq-4/</a></p>
<h4 id="可用性-1"><a href="#可用性-1" class="headerlink" title="可用性"></a>可用性</h4><h4 id="延迟和积压问题"><a href="#延迟和积压问题" class="headerlink" title="延迟和积压问题"></a>延迟和积压问题</h4><h4 id="自己设计"><a href="#自己设计" class="headerlink" title="自己设计"></a>自己设计</h4><p><a href="http://jm.taobao.org/2017/03/23/20170323/" target="_blank" rel="noopener">http://jm.taobao.org/2017/03/23/20170323/</a></p>
<h3 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h3><h3 id="共识算法理论"><a href="#共识算法理论" class="headerlink" title="共识算法理论"></a>共识算法理论</h3><h3 id="分布式事务实践"><a href="#分布式事务实践" class="headerlink" title="分布式事务实践"></a>分布式事务实践</h3><p>借鉴蚂蚁金服分布式事务中间件 <a href="https://github.com/seata/seata" target="_blank" rel="noopener">https://github.com/seata/seata</a></p>
<p>XA采用2PC模式，实际微服务实践中不用，因为不允许跨服务访问数据库</p>
<h4 id="SAGA模式"><a href="#SAGA模式" class="headerlink" title="SAGA模式"></a>SAGA模式</h4><p>基于状态机引擎，一致性弱，适用于事务参与者无法接入TCC改造的过程</p>
<p>可能会出现脏写，但是会尽可能保证最终一致性</p>
<p><a href="https://www.sofastack.tech/blog/sofa-channel-10-retrospect/" target="_blank" rel="noopener">https://www.sofastack.tech/blog/sofa-channel-10-retrospect/</a></p>
<h4 id="RocketMQ事务消息："><a href="#RocketMQ事务消息：" class="headerlink" title="RocketMQ事务消息："></a>RocketMQ事务消息：</h4><ol>
<li><p>发送者发半事务消息给消息队列</p>
</li>
<li><p>发送者执行事务</p>
</li>
<li><p>发送者提交二次确认消息/消息队列回查发送者，确认提交/回滚</p>
</li>
<li><p>消息队列负责不断重试投递给订阅者</p>
</li>
<li>订阅者失败，则报警人工处理</li>
</ol>
<h4 id="AT模式："><a href="#AT模式：" class="headerlink" title="AT模式："></a>AT模式：</h4><p>无侵入，二阶段回滚出现脏写需要人工介入</p>
<p>步骤：</p>
<ul>
<li><p>框架拦截SQL，找到要更新的数据，在执行前后保存快照，再获取行锁</p>
</li>
<li><p>提交：删除快照和行锁</p>
</li>
<li>回滚：对比<strong>当前数据</strong>和<strong>执行后快照</strong>，一致则还原，不一致则转人工</li>
</ul>
<h4 id="TCC模式："><a href="#TCC模式：" class="headerlink" title="TCC模式："></a>TCC模式：</h4><p>个人理解和2PC实际上是一回事，只不过2PC直接操作数据库事务，而TCC把这一概念放到了业务层，并且不需要持久层实际支持XA。</p>
<p>相比AT侵入性高，但是没有全局行锁，性能高</p>
<p>需要改造业务，业务分为try confirm和cancel步骤，try预留资源，confirm实际执行，cancel释放资源。</p>
<ul>
<li><p>幂等性：需要保证三个步骤<strong>幂等</strong>。</p>
</li>
<li><p>并发控制：try预留的资源必须与事务ID关联，不同事务不能预留同一资源。</p>
</li>
<li><p>支持空回滚：需要在try业务未达时，就能处理cancel业务。</p>
</li>
<li><p>防悬挂：需要在cancel业务处理完后，能拒绝try业务。</p>
</li>
</ul>
<p>整个事务所有方法每一步执行落地数据库，这样每个事务可查。</p>
<p>优化：confirm/cancel操作可以异步执行，事务记录可以记录在发起者业务数据库。</p>
<h3 id="分布式事务理论"><a href="#分布式事务理论" class="headerlink" title="分布式事务理论"></a>分布式事务理论</h3><h4 id="2PC优化"><a href="#2PC优化" class="headerlink" title="2PC优化"></a>2PC优化</h4><p><a href="http://oceanbase.org.cn/?p=195" target="_blank" rel="noopener">http://oceanbase.org.cn/?p=195</a></p>
<h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p><a href="https://doocs.github.io/advanced-java/#/./docs/high-concurrency/why-cache" target="_blank" rel="noopener">https://doocs.github.io/advanced-java/#/./docs/high-concurrency/why-cache</a></p>
<h4 id="Redis线程模型"><a href="#Redis线程模型" class="headerlink" title="Redis线程模型"></a>Redis线程模型</h4><h4 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h4><h4 id="Redis性能，生产部署"><a href="#Redis性能，生产部署" class="headerlink" title="Redis性能，生产部署"></a>Redis性能，生产部署</h4><h4 id="Redis哨兵高可用"><a href="#Redis哨兵高可用" class="headerlink" title="Redis哨兵高可用"></a>Redis哨兵高可用</h4><h4 id="Redis穿透、雪崩、击穿"><a href="#Redis穿透、雪崩、击穿" class="headerlink" title="Redis穿透、雪崩、击穿"></a>Redis穿透、雪崩、击穿</h4><h4 id="数据库一致性"><a href="#数据库一致性" class="headerlink" title="数据库一致性"></a>数据库一致性</h4><h4 id="Redis锁和事务"><a href="#Redis锁和事务" class="headerlink" title="Redis锁和事务"></a>Redis锁和事务</h4><h3 id="微服务实践"><a href="#微服务实践" class="headerlink" title="微服务实践"></a>微服务实践</h3><h4 id="服务治理实践"><a href="#服务治理实践" class="headerlink" title="服务治理实践"></a>服务治理实践</h4><h4 id="微服务框架使用"><a href="#微服务框架使用" class="headerlink" title="微服务框架使用"></a>微服务框架使用</h4><h4 id="微服务拆分实践"><a href="#微服务拆分实践" class="headerlink" title="微服务拆分实践"></a>微服务拆分实践</h4><h3 id="领域驱动设计"><a href="#领域驱动设计" class="headerlink" title="领域驱动设计"></a>领域驱动设计</h3><p><a href="https://tech.meituan.com/2017/12/22/ddd-in-practice.html" target="_blank" rel="noopener">https://tech.meituan.com/2017/12/22/ddd-in-practice.html</a></p>

  </article>
</div>


    
<div class="container disqus-container">
  <div id="disqus_thread"></div>
</div>

<script>
  var disqus_config = function() {
    this.page.url = "http://blog.mothership.top/2020/04/13/2020-04-13-高阶面试题知识集合笔记/";
    this.page.identifier = 1586764396;
  };

  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://mother-ship.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>





</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="http://blog.mothership.top" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 Mother Ship</li>
      <li><a href="http://blog.mothership.top">Home</a></li>
      
      <li><a href="https://github.com/Mother-Ship">Github</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica">Replica</a>
      by <a href="//github.com/sabrinaluo">Hiitea</a> ❤ Powered by Hexo
    </div>
    </div>
    
  </footer>
</div>


<script>
  (function() {
    var cx = '015302745202112709039:d2rq52htkfe';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>



<script src="/js/main.js"></script>

</body>
</html>
